<div class="kanban-wrapper">
    <div class="kanban-content">
        <div class="page-header">
            <div class="welcome-section">
                <h1>{{ currentTheme?.emoji }} Kanban Board</h1>
                <p>Organiziraj zadatke uz drag & drop funkcionalnost</p>
            </div>
            <div class="header-actions">
                <button (click)="toggleStatsPanel()" class="btn-stats">ğŸ“Š Statistika</button>
                <button routerLink="/fun-zone" class="btn-settings">â¬…ï¸ Nazad</button>
                <button (click)="logout()" class="btn-logout">ğŸšª Odjavi se</button>
            </div>
        </div>

        <div class="controls">
            <button (click)="openAddTask()">â• Dodaj zadatak</button>
            <button (click)="saveBoard()" [disabled]="isSaving">
                {{ isSaving ? 'â³ Spremanje...' : 'ğŸ’¾ Snimi' }}
            </button>
            <button (click)="openClearBoard()">ğŸ—‘ï¸ OÄisti ploÄu</button>
        </div>

        <!-- Save message -->
        <div class="save-message" *ngIf="saveMessage" [class.success]="saveMessage.includes('âœ…')"
            [class.error]="saveMessage.includes('âŒ')">
            {{ saveMessage }}
        </div>

        <!-- Modal za dodavanje zadatka -->
        <div class="modal" [class.show]="showTaskModal" (click)="cancelAdd()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <h3>Dodaj zadatak</h3>
                <input type="text" [(ngModel)]="taskInput" placeholder="VaÅ¡ zadatak..." (keyup.enter)="addTask()" />
                <div class="modal-buttons">
                    <button (click)="addTask()">Dodaj</button>
                    <button (click)="cancelAdd()">PoniÅ¡ti</button>
                </div>
            </div>
        </div>

        <!-- Modal za brisanje ploÄe -->
        <div class="modal" [class.show]="showClearModal" (click)="cancelClear()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <h3>OÄisti cijelu ploÄu?</h3>
                <p>Ova se radnja ne moÅ¾e poniÅ¡titi.</p>
                <div class="modal-buttons">
                    <button (click)="clearBoard()" style="background:#e74c3c;">OÄisti</button>
                    <button (click)="cancelClear()">PoniÅ¡ti</button>
                </div>
            </div>
        </div>

        <!-- Kanban ploÄa s tri kolone -->
        <div class="board">
            <div class="column" (dragover)="onDragOver($event)" (drop)="onDrop('todo')">
                <h2>To Do</h2>
                <div class="taskList">
                    <div *ngFor="let task of getTasks('todo')" class="task" draggable="true"
                        (dragstart)="onDragStart(task)" (dragend)="onDragEnd()">
                        {{ task.text }}
                    </div>
                </div>
            </div>

            <div class="column" (dragover)="onDragOver($event)" (drop)="onDrop('progress')">
                <h2>In Progress</h2>
                <div class="taskList">
                    <div *ngFor="let task of getTasks('progress')" class="task" draggable="true"
                        (dragstart)="onDragStart(task)" (dragend)="onDragEnd()">
                        {{ task.text }}
                    </div>
                </div>
            </div>

            <div class="column" (dragover)="onDragOver($event)" (drop)="onDrop('done')">
                <h2>Done</h2>
                <div class="taskList">
                    <div *ngFor="let task of getTasks('done')" class="task" draggable="true"
                        (dragstart)="onDragStart(task)" (dragend)="onDragEnd()">
                        {{ task.text }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Panel -->
<div class="stats-panel" [class.visible]="showStatsPanel">
    <div class="stats-card">
        <button class="stats-close-btn" type="button" aria-label="Zatvori" (click)="toggleStatsPanel()">Ã—</button>
        <h3>ğŸ“Š Tvoja Kanban Statistika</h3>

        <div class="stats-loading" *ngIf="!stats">
            <span>UÄitavanje...</span>
        </div>

        <div class="stats-grid" *ngIf="stats">
            <div class="stat-item">
                <span class="stat-value">{{ stats.tasksCreated }}</span>
                <span class="stat-label">Kreirano zadataka</span>
            </div>
            <div class="stat-item highlight">
                <span class="stat-value">{{ stats.tasksCompleted }}</span>
                <span class="stat-label">âœ… ZavrÅ¡eno</span>
            </div>
        </div>

        <div class="completion-rate" *ngIf="stats && stats.tasksCreated > 0">
            <div class="rate-label">Stopa zavrÅ¡etka</div>
            <div class="rate-bar">
                <div class="rate-fill" [style.width.%]="(stats.tasksCompleted / stats.tasksCreated) * 100"></div>
            </div>
            <div class="rate-value">{{ ((stats.tasksCompleted / stats.tasksCreated) * 100).toFixed(0) }}%</div>
        </div>

        <p class="stats-note" *ngIf="stats?.tasksCreated === 0">
            Dodaj prvi zadatak da poÄneÅ¡ pratiti produktivnost! ğŸ“‹
        </p>
    </div>
</div>
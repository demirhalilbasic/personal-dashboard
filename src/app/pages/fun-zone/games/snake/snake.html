<div class="snake-wrapper">
    <div class="snake-content">
        <div class="page-header">
            <div class="welcome-section">
                <h1>{{ currentTheme?.emoji }} Snake Game</h1>
                <p>KlasiÄna igra zmije - sakupljaj IPI logo i rasti!</p>
            </div>
            <div class="header-actions">
                <button class="btn-stats" (click)="toggleStatsPanel()">ğŸ“Š Statistika</button>
                <button class="btn-info" (click)="showInstructions = true">â“ Upute</button>
                <button class="btn-settings" routerLink="/fun-zone">â¬…ï¸ Fun Zone</button>
                <button class="btn-logout" (click)="logout()">ğŸšª Odjava</button>
            </div>
        </div>

        <div class="game-container">
            <div class="game-info">
                <div class="score-display">
                    <div class="current-score">ğŸ† Bodovi: {{ score }}</div>
                    <div class="high-score" *ngIf="stats">ğŸ¥‡ Rekord: {{ stats.highScore }}</div>
                </div>
                <button *ngIf="!gameStarted || gameOver" (click)="startGame()" class="start-btn">ğŸ® {{ gameOver ? 'Igraj
                    ponovo' : 'ZapoÄni igru' }}</button>
                <button *ngIf="gameStarted && !gameOver" (click)="startGame()" class="restart-btn">ğŸ”„ Restart</button>
            </div>

            <canvas #canvas></canvas>
        </div>
    </div>
</div>

<!-- Game Over Modal -->
<div class="modal-overlay" [class.visible]="showGameOverModal" role="dialog" aria-modal="true"
    aria-labelledby="gameOverTitle">
    <div class="modal-card">
        <button class="modal-close-btn" type="button" aria-label="Zatvori" (click)="closeModal()">Ã—</button>
        <h2 id="gameOverTitle" *ngIf="!isNewHighScore">ğŸ’€ Game Over!</h2>
        <h2 id="gameOverTitle" *ngIf="isNewHighScore">ğŸ‰ Novi Rekord!</h2>
        <p>VaÅ¡ rezultat: <strong>{{ score }}</strong> bodova</p>
        <p *ngIf="isNewHighScore" class="new-record-text">ÄŒestitamo! Postigli ste novi osobni rekord!</p>
        <p *ngIf="stats && !isNewHighScore" class="previous-record">Rekord: {{ stats.highScore }} bodova</p>
        <div class="modal-actions">
            <button type="button" (click)="startGame()">ğŸ® Igraj ponovo</button>
            <button type="button" (click)="closeModal()">âŒ Zatvori</button>
        </div>
    </div>
</div>

<!-- Instructions Modal -->
<div class="modal-overlay" [class.visible]="showInstructions" role="dialog" aria-modal="true"
    aria-labelledby="instructionsTitle">
    <div class="modal-card instructions-modal">
        <button class="modal-close-btn" type="button" aria-label="Zatvori" (click)="showInstructions = false">Ã—</button>
        <h2 id="instructionsTitle">ğŸ¯ Kako igrati</h2>
        <ul class="instructions-list">
            <li>â¬†ï¸â¬‡ï¸â¬…ï¸â¡ï¸ Koristite strelice na tastaturi za kontrolu zmije</li>
            <li>ğŸ¯ Sakupljajte IPI logo da biste porasli i osvojili bodove</li>
            <li>âš ï¸ Nemojte udariti u zidove ili sebe!</li>
        </ul>
        <div class="modal-actions">
            <button type="button" (click)="showInstructions = false">ğŸ‘ Razumijem</button>
        </div>
    </div>
</div>

<!-- Stats Panel -->
<div class="stats-panel" [class.visible]="showStatsPanel">
    <div class="stats-card">
        <button class="stats-close-btn" type="button" aria-label="Zatvori" (click)="toggleStatsPanel()">Ã—</button>
        <h3>ğŸ“Š Tvoja Snake Statistika</h3>

        <div class="stats-loading" *ngIf="!stats">
            <span>UÄitavanje...</span>
        </div>

        <div class="stats-grid" *ngIf="stats">
            <div class="stat-item">
                <span class="stat-value">{{ stats.gamesPlayed }}</span>
                <span class="stat-label">Odigrano igara</span>
            </div>
            <div class="stat-item highlight">
                <span class="stat-value">{{ stats.highScore }}</span>
                <span class="stat-label">ğŸ¥‡ Rekord</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ stats.totalScore }}</span>
                <span class="stat-label">Ukupno bodova</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ stats.averageScore }}</span>
                <span class="stat-label">ProsjeÄni rezultat</span>
            </div>
        </div>

        <p class="stats-note" *ngIf="stats?.gamesPlayed === 0">
            Odigraj prvu igru da poÄneÅ¡ skupljati statistiku! ğŸ®
        </p>
    </div>
</div>
<div class="tracker-container">
    <div class="tracker-content">
        <!-- Header -->
        <div class="tracker-header">
            <div class="header-left">
                <button class="btn-back" routerLink="/my-trackers">â† Nazad</button>
                <div class="tracker-title" *ngIf="tracker">
                    <span class="tracker-icon" [style.backgroundColor]="tracker.color + '20'">{{ tracker.icon }}</span>
                    <div class="title-text">
                        <h1>{{ tracker.name }}</h1>
                        <p>{{ tracker.description }}</p>
                    </div>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-icon">ğŸ”¥</span>
                    <span class="stat-value">{{ streak }}</span>
                    <span class="stat-label">streak</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">ğŸ“Š</span>
                    <span class="stat-value">{{ weeklyProgress }}%</span>
                    <span class="stat-label">sedmica</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">ğŸ“ˆ</span>
                    <span class="stat-value">{{ monthlyProgress }}%</span>
                    <span class="stat-label">mjesec</span>
                </div>
            </div>
        </div>

        <!-- Date Selector -->
        <div class="date-section">
            <button class="date-picker-btn" (click)="toggleDatePicker()">
                <span class="date-icon">ğŸ“…</span>
                <span class="date-text">{{ formatDateShort(selectedDate) }}</span>
                <span class="date-arrow">â–¼</span>
            </button>

            <!-- Date Picker Popup -->
            <div class="date-picker-popup" *ngIf="showDatePicker">
                <div class="date-option" *ngFor="let date of dateOptions" [class.active]="selectedDate === date"
                    [class.today]="isToday(date)" (click)="selectDate(date)">
                    <span class="date-day">{{ getDayName(date) }}</span>
                    <span class="date-full">{{ formatDateShort(date) }}</span>
                    <span class="date-badge" *ngIf="isToday(date)">Danas</span>
                </div>
            </div>
        </div>

        <!-- Popup Overlay -->
        <div class="date-picker-overlay" *ngIf="showDatePicker" (click)="closeDatePicker()"></div>

        <!-- Loading -->
        <div class="loading" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>UÄitavanje navika...</p>
        </div>

        <!-- Main Content -->
        <div class="main-content" *ngIf="!isLoading">
            <!-- Progress Circle -->
            <div class="progress-section">
                <div class="progress-circle"
                    [style.background]="'conic-gradient(var(--color-primary) ' + getCompletionPercentage() * 3.6 + 'deg, var(--color-background) 0deg)'">
                    <div class="progress-inner">
                        <span class="progress-value">{{ getCompletionPercentage() }}%</span>
                        <span class="progress-label">zavrÅ¡eno</span>
                    </div>
                </div>
                <div class="progress-info">
                    <p>{{ getCompletedHabitsCount() }} / {{ habits.length }} navika zavrÅ¡eno danas</p>
                </div>
            </div>

            <!-- Habits List -->
            <div class="habits-section">
                <div class="section-header">
                    <h2>ğŸ“‹ Moje navike</h2>
                    <button class="btn-add" (click)="showAddHabit = true">+ Dodaj naviku</button>
                </div>

                <!-- Add Habit Form -->
                <div class="add-habit-form" *ngIf="showAddHabit">
                    <input type="text" [(ngModel)]="newHabitName" placeholder="Naziv nove navike..."
                        (keyup.enter)="addHabit()">
                    <button class="btn-confirm" (click)="addHabit()">âœ“</button>
                    <button class="btn-cancel" (click)="showAddHabit = false; newHabitName = ''">âœ•</button>
                </div>

                <!-- Habits -->
                <div class="habits-list" *ngIf="habits.length > 0">
                    <div class="habit-item" *ngFor="let habit of habits; let i = index"
                        [class.completed]="habit.completed">
                        <button class="habit-checkbox" (click)="toggleHabit(i)">
                            <span *ngIf="habit.completed">âœ“</span>
                        </button>
                        <div class="habit-info">
                            <span class="habit-name">{{ habit.name }}</span>
                            <span class="habit-streak" *ngIf="habit.streak > 0">ğŸ”¥ {{ habit.streak }} dana</span>
                        </div>
                        <button class="btn-remove" (click)="removeHabit(i)" title="Ukloni naviku">ğŸ—‘ï¸</button>
                    </div>
                </div>

                <div class="no-habits" *ngIf="habits.length === 0 && !showAddHabit">
                    <p>ğŸ“ Nemate dodanih navika. Kliknite "Dodaj naviku" za poÄetak!</p>
                </div>
            </div>

            <!-- Weekly Chart -->
            <div class="chart-section">
                <h2>ğŸ“Š SedmiÄni pregled</h2>
                <div class="bar-chart">
                    <div class="bar-item" *ngFor="let data of weeklyData">
                        <div class="bar" [style.height.%]="getBarHeight(data)">
                            <span class="bar-value" *ngIf="data.total > 0">{{ data.completed }}/{{ data.total }}</span>
                        </div>
                        <span class="bar-label">{{ data.day }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saving Indicator -->
        <div class="saving-indicator" *ngIf="isSaving">
            <span>ğŸ’¾ Spremanje...</span>
        </div>
    </div>
</div>
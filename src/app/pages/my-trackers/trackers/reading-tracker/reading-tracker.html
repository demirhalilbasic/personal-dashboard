<div class="tracker-container">
    <div class="tracker-content">
        <div class="tracker-header">
            <div class="header-left">
                <button class="btn-back" routerLink="/my-trackers">â† Nazad</button>
                <div class="tracker-title" *ngIf="tracker">
                    <span class="tracker-icon" [style.backgroundColor]="tracker.color + '20'">{{ tracker.icon }}</span>
                    <div class="title-text">
                        <h1>{{ tracker.name }}</h1>
                        <p>{{ tracker.description }}</p>
                    </div>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item"><span class="stat-icon">ğŸ”¥</span><span class="stat-value">{{ streak
                        }}</span><span class="stat-label">streak</span></div>
                <div class="stat-item"><span class="stat-icon">ğŸ“–</span><span class="stat-value">{{ totalPagesThisWeek
                        }}</span><span class="stat-label">stranica/tjedan</span></div>
            </div>
        </div>

        <!-- Date Selector -->
        <div class="date-section">
            <button class="date-picker-btn" (click)="toggleDatePicker()">
                <span class="date-icon">ğŸ“…</span>
                <span class="date-text">{{ formatDateShort(selectedDate) }}</span>
                <span class="date-arrow">â–¼</span>
            </button>

            <!-- Date Picker Popup -->
            <div class="date-picker-popup" *ngIf="showDatePicker">
                <div class="date-option" *ngFor="let date of dateOptions" [class.active]="selectedDate === date"
                    [class.today]="isToday(date)" (click)="selectDate(date)">
                    <span class="date-day">{{ getDayName(date) }}</span>
                    <span class="date-full">{{ formatDateShort(date) }}</span>
                    <span class="date-badge" *ngIf="isToday(date)">Danas</span>
                </div>
            </div>
        </div>

        <!-- Popup Overlay -->
        <div class="date-picker-overlay" *ngIf="showDatePicker" (click)="closeDatePicker()"></div>

        <div class="loading" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>UÄitavanje...</p>
        </div>

        <div class="main-content" *ngIf="!isLoading">
            <div class="book-section">
                <h3>ğŸ“š Trenutna knjiga</h3>
                <div class="book-form">
                    <div class="form-group flex-2">
                        <label>Naslov knjige</label>
                        <input type="text" [(ngModel)]="bookTitle" placeholder="Naziv knjige koju Äitate">
                    </div>
                    <div class="form-group">
                        <label>Autor</label>
                        <input type="text" [(ngModel)]="author" placeholder="Ime autora">
                    </div>
                </div>
                <div class="book-progress">
                    <div class="progress-inputs">
                        <div class="form-group">
                            <label>Trenutna stranica</label>
                            <input type="number" [(ngModel)]="currentPage" min="0">
                        </div>
                        <span class="divider">/</span>
                        <div class="form-group">
                            <label>Ukupno stranica</label>
                            <input type="number" [(ngModel)]="totalPages" min="1">
                        </div>
                    </div>
                    <div class="progress-visual">
                        <div class="book-visual">
                            <div class="book-pages" [style.width.%]="getProgressPercentage()"></div>
                        </div>
                        <span class="progress-percent">{{ getProgressPercentage() }}%</span>
                    </div>
                </div>
            </div>

            <div class="today-section">
                <h3>ğŸ“– DanaÅ¡nje Äitanje</h3>
                <div class="reading-stats">
                    <div class="stat-card">
                        <span class="stat-emoji">ğŸ“„</span>
                        <div class="stat-input">
                            <input type="number" [(ngModel)]="pagesRead" min="0">
                            <label>stranica proÄitano</label>
                        </div>
                        <div class="goal-progress">
                            <div class="goal-bar" [style.width.%]="getPagesGoalPercentage()"></div>
                        </div>
                        <span class="goal-text">Cilj: {{ dailyGoalPages }} stranica</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-emoji">â±ï¸</span>
                        <div class="stat-input">
                            <input type="number" [(ngModel)]="minutesRead" min="0">
                            <label>minuta Äitanja</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="notes-section">
                <h3>ğŸ“ BiljeÅ¡ke</h3>
                <textarea [(ngModel)]="notes" placeholder="ZapiÅ¡ite misli, citate ili ideje iz knjige..."
                    rows="4"></textarea>
            </div>

            <div class="rating-section">
                <h3>â­ Ocjena</h3>
                <div class="star-rating">
                    <button *ngFor="let star of [1,2,3,4,5]" class="star-btn" [class.active]="star <= rating"
                        (click)="setRating(star)">
                        â­
                    </button>
                </div>
            </div>

            <div class="chart-section">
                <h3>ğŸ“ˆ Stranice ovog tjedna</h3>
                <div class="weekly-chart">
                    <div class="chart-bar-group" *ngFor="let d of weeklyData">
                        <div class="bar-container">
                            <div class="bar" [style.height.%]="(d.pages / getMaxWeeklyPages()) * 100"></div>
                        </div>
                        <span class="bar-label">{{ d.day }}</span>
                    </div>
                </div>
            </div>

            <button class="btn-save" (click)="saveData()" [disabled]="isSaving">
                {{ isSaving ? 'ğŸ’¾ Spremanje...' : 'ğŸ’¾ Spremi' }}
            </button>
        </div>

        <div class="saving-indicator" *ngIf="isSaving"><span>ğŸ’¾ Spremanje...</span></div>
    </div>
</div>
<div class="tracker-container">
    <div class="tracker-content">
        <!-- Header -->
        <div class="tracker-header">
            <div class="header-left">
                <button class="btn-back" routerLink="/my-trackers">â† Nazad</button>
                <div class="tracker-title" *ngIf="tracker">
                    <span class="tracker-icon" [style.backgroundColor]="tracker.color + '20'">{{ tracker.icon }}</span>
                    <div class="title-text">
                        <h1>{{ tracker.name }}</h1>
                        <p>{{ tracker.description }}</p>
                    </div>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-icon">ğŸ”¥</span>
                    <span class="stat-value">{{ streak }}</span>
                    <span class="stat-label">streak</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">ğŸ“Š</span>
                    <span class="stat-value">{{ weeklyProgress }}%</span>
                    <span class="stat-label">sedmica</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">ğŸ“ˆ</span>
                    <span class="stat-value">{{ monthlyProgress }}%</span>
                    <span class="stat-label">mjesec</span>
                </div>
            </div>
        </div>

        <!-- Date Selector -->
        <div class="date-section">
            <button class="date-picker-btn" (click)="toggleDatePicker()">
                <span class="date-icon">ğŸ“…</span>
                <span class="date-text">{{ formatDateShort(selectedDate) }}</span>
                <span class="date-arrow">â–¼</span>
            </button>

            <!-- Date Picker Popup -->
            <div class="date-picker-popup" *ngIf="showDatePicker">
                <div class="date-option" *ngFor="let date of dateOptions" [class.active]="selectedDate === date"
                    [class.today]="isToday(date)" (click)="selectDate(date)">
                    <span class="date-day">{{ getDayName(date) }}</span>
                    <span class="date-full">{{ formatDateShort(date) }}</span>
                    <span class="date-badge" *ngIf="isToday(date)">Danas</span>
                </div>
            </div>
        </div>

        <!-- Popup Overlay -->
        <div class="date-picker-overlay" *ngIf="showDatePicker" (click)="closeDatePicker()"></div>

        <!-- Loading -->
        <div class="loading" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>UÄitavanje...</p>
        </div>

        <!-- Main Content -->
        <div class="main-content" *ngIf="!isLoading">
            <!-- Water Bottle Visual -->
            <div class="water-section">
                <div class="water-bottle">
                    <div class="bottle-cap"></div>
                    <div class="bottle-body">
                        <div class="water-level" [style.height.%]="getWaterLevel()">
                        </div>
                        <div class="bottle-markings">
                            <span *ngFor="let mark of [100, 75, 50, 25]" [style.bottom.%]="mark">{{ mark }}%</span>
                        </div>
                    </div>
                </div>

                <div class="water-info">
                    <div class="water-count">
                        <span class="count-current">{{ glasses }}</span>
                        <span class="count-separator">/</span>
                        <span class="count-goal">{{ goal }}</span>
                    </div>
                    <p class="water-label">ÄaÅ¡a vode</p>
                    <p class="water-ml">â‰ˆ {{ glasses * 250 }} ml</p>

                    <div class="water-controls">
                        <button class="btn-water remove" (click)="removeGlass()" [disabled]="glasses === 0">âˆ’</button>
                        <button class="btn-water add" (click)="addGlass()" [disabled]="glasses >= goal">+</button>
                    </div>

                    <div class="goal-section">
                        <label>ğŸ¯ Dnevni cilj:</label>
                        <div class="goal-options">
                            <button *ngFor="let g of [6, 8, 10, 12]" class="goal-btn" [class.active]="goal === g"
                                (click)="setGoal(g)">{{ g }}</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Glasses Visual -->
            <div class="glasses-section">
                <h3>ğŸ’§ DanaÅ¡nji unos</h3>
                <div class="glasses-grid">
                    <div class="glass" *ngFor="let filled of glassesArray; let i = index" [class.filled]="filled"
                        (click)="setGlasses(i + 1)">
                        <div class="glass-water" *ngIf="filled"></div>
                        <span class="glass-number">{{ i + 1 }}</span>
                    </div>
                </div>
            </div>

            <!-- Times Log -->
            <div class="times-section" *ngIf="times.length > 0">
                <h3>â° Vremena unosa</h3>
                <div class="times-list">
                    <span class="time-badge" *ngFor="let time of times">{{ time }}</span>
                </div>
            </div>

            <!-- Weekly Chart -->
            <div class="chart-section">
                <h2>ğŸ“Š SedmiÄni pregled</h2>
                <div class="bar-chart">
                    <div class="chart-grid">
                        <div class="grid-line" *ngFor="let line of [goal, goal*0.75, goal*0.5, goal*0.25, 0]">
                            <span class="grid-label">{{ line | number:'1.0-0' }}</span>
                        </div>
                    </div>
                    <div class="bars-container">
                        <div class="bar-item" *ngFor="let data of weeklyData">
                            <div class="bar" [style.height.%]="(data.glasses / goal) * 100">
                                <span class="bar-value">{{ data.glasses }}</span>
                            </div>
                            <span class="bar-label">{{ data.day }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tips -->
            <div class="tips-section">
                <h3>ğŸ’¡ Savjeti za hidrataciju</h3>
                <div class="tips-grid">
                    <div class="tip-card">
                        <span class="tip-icon">ğŸŒ…</span>
                        <p>Popijte ÄaÅ¡u vode odmah ujutro</p>
                    </div>
                    <div class="tip-card">
                        <span class="tip-icon">ğŸ½ï¸</span>
                        <p>Pijte vodu prije svakog obroka</p>
                    </div>
                    <div class="tip-card">
                        <span class="tip-icon">ğŸ“±</span>
                        <p>Postavite podsjetnike na telefon</p>
                    </div>
                    <div class="tip-card">
                        <span class="tip-icon">ğŸƒ</span>
                        <p>PoveÄ‡ajte unos za vrijeme vjeÅ¾banja</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saving Indicator -->
        <div class="saving-indicator" *ngIf="isSaving">
            <span>ğŸ’¾ Spremanje...</span>
        </div>
    </div>
</div>